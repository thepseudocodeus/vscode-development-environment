# https://taskfile.dev
# Expert-grade Taskfile Template
# Designed for reproducible, idempotent, and self-teaching workflows.

version: '3'

# Global environment and variable declarations
env:
  PYTHON_VERSION: "3.12.1"
  SRC_DIR: "src"
  TEST_DIR: "tests"
  LOG_DIR: "logs"
  DEPS_FILE: "dependencies.yml"

vars:
  PROJECT_NAME: "{{.PROJECT_NAME | default \"my_project\"}}"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§­ Meta Tasks
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tasks:

  help:
    desc: "Show all available tasks"
    cmds:
      - task --list
    summary: |
      Displays all available tasks with their descriptions.
      Use this as your command map for daily development.

  default:
    desc: "Show the help screen when no task is specified"
    cmds:
      - task: help
    summary: |
      Default entrypoint. Run `task` alone to get help output.


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§© Environment Validation and Setup
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  validate-system:
    desc: "Check for required system tools"
    cmds:
      - echo "ğŸ” Validating core tools..."
      - which python3 || (echo "âŒ Python3 not found" && exit 1)
      - which pip || (echo "âŒ pip not found" && exit 1)
      - which uv || echo "âš ï¸ UV not installed yet"
      - echo "âœ… Validation complete."
    summary: |
      Ensures core CLI tools (python3, pip, uv) exist before setup continues.
      This is the first line of defense against environment drift.

  install-uv:
    desc: "Install UV package manager (idempotent)"
    deps: [validate-system]
    cmds:
      - |
        if ! command -v uv &> /dev/null; then
          echo "ğŸ”¹ Installing uv..."
          pip install --upgrade pip
          pip install uv
        else
          echo "âš¡ uv already installed."
        fi
    summary: |
      Installs or upgrades the UV package manager.
      UV manages Python environments and reproducible builds.

  uv-init:
    desc: "Initialize UV project if not already set up"
    deps: [install-uv]
    cmds:
      - |
        if [ ! -f "pyproject.toml" ]; then
          echo "ğŸ”¹ Initializing uv project..."
          uv init
        else
          echo "âš¡ UV project already initialized."
        fi
    summary: |
      Initializes a new UV-managed Python project if none exists yet.


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ Python Environment Setup
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  install-python-deps:
    desc: "Install Python dependencies via UV"
    deps: [uv-init]
    cmds:
      - echo "ğŸ”¹ Installing dependencies..."
      - uv add typer InquirerPy loguru pytest results black mypy flake8 isort
    summary: |
      Installs Python dependencies in a reproducible UV-managed environment.
      Add or remove dependencies here as your project evolves.

  sync-env:
    desc: "Sync Python environment with pyproject.toml"
    deps: [install-python-deps]
    cmds:
      - echo "ğŸ”„ Syncing environment..."
      - sudo apt-get update -y
      - sudo apt-get upgrade -y
      - uv update
      - npm update -g npm
      - task update
      - uv sync
    summary: |
      Ensures your local Python environment matches the dependency lock file.


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§± Project Structure & Build
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  build-dirs:
    desc: "Create consistent project directories"
    cmds:
      - echo "ğŸ“ Creating directories..."
      - mkdir -p {{.SRC_DIR}} {{.TEST_DIR}} docs scripts {{.LOG_DIR}}
      - mkdir -p {{.SRC_DIR}}/core {{.SRC_DIR}}/lib {{.SRC_DIR}}/cli {{.SRC_DIR}}/utils {{.SRC_DIR}}/web
      - echo "âœ… Directory structure ready."
    summary: |
      Ensures a consistent folder structure for source, tests, and documentation.

  add-init-files:
    desc: "Add __init__.py files to source and test directories"
    cmds:
      - echo "ğŸ“ Adding __init__.py files..."
      - uv run init_all.py
      - echo "âœ… __init__.py files added."
    summary: |
      Adds __init__.py files to all subdirectories in source and test folders.
      Ensures Python treats these directories as packages.

  git-setup:
    desc: "Initialize a new git repository"
    cmds:
      - |
        if [ ! -d ".git" ]; then
          echo "ğŸ”¹ Initializing git repository..."
          git init
          git add .
          git commit -m "Initial commit"
          git branch -M main
          echo "âœ… Git repository initialized."
        else
          echo "âš¡ Git repository already exists."
        fi
    summary: |
      Sets up a new git repository if one does not already exist.

  dev-setup:
    desc: "Full developer setup"
    deps: [sync-env, build-dirs]
    cmds:
      - echo "ğŸš€ Development environment ready for {{.PROJECT_NAME}}!"
      - echo ""
      - echo "ğŸ“„ Summary:"
      - echo "  - UV project initialized"
      - echo "  - Dependencies installed"
      - echo "  - Directories created"
      - task: add-init-files
      - echo "  - Init files added"
      - task: git-setup
      - echo "  - Git repository set up"
      - echo "Installing yaml formatters and linters..."
      - uv add yamllint
      - echo ""
      - npm install -g prettier @prettier/plugin-yaml yamlfmt
      - echo "âœ… You can now start coding!"
      - echo "ğŸ‘‰ Recommended next steps:"
      - echo "connect remote git repository"
    summary: |
      Complete one-shot setup for new environments or fresh containers.
      Combines validation, dependency installation, and structure setup.

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§ª Testing & Linting
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  test:
    desc: "Run all tests via UV-managed pytest"
    cmds:
      - echo "ğŸ”¹ Running tests..."
      - uv run pytest -v --disable-warnings
      - echo ""
      - echo "ğŸ“Š Test Summary:"
      - echo "  - Tests completed successfully âœ…"
      - echo "  - Timestamp $(date)"
    summary: |
      Runs the projectâ€™s full test suite in the UV-managed environment.
      Includes a dynamic runtime summary for immediate feedback.

  lint:
    desc: "Run linting and static analysis tools"
    cmds:
      - uv run black --check {{.SRC_DIR}}
      - uv run flake8 {{.SRC_DIR}}
      - uv run isort --check-only {{.SRC_DIR}}
      - uv run mypy {{.SRC_DIR}}
      - echo "âœ… Linting passed!"
    summary: |
      Enforces style and static correctness using black, flake8, isort, and mypy.

  format:
    desc: "Auto-format code for consistent style"
    cmds:
      - uv run black {{.SRC_DIR}}
      - uv run isort {{.SRC_DIR}}
      - echo "âœ… Code formatted successfully."
    summary: |
      Formats code using black and isort for consistent project style.


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§¾ Quality & Maintenance
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  check:
    desc: "Run full quality assurance suite (lint + test)"
    deps: [lint, test]
    summary: |
      Aggregates quality checks for CI/CD and local confidence.
      Runs all static analysis and tests to validate correctness.

  clean:
    desc: "Clean up temporary and cache files"
    cmds:
      - echo "ğŸ§¹ Cleaning up temporary files..."
      - rm -rf __pycache__ .pytest_cache .mypy_cache {{.LOG_DIR}}/*
      - echo "âœ… Cleanup complete."
    summary: |
      Removes temporary and cache files to keep your project clean and predictable.
